---
// Componente de Login con Facebook
const FACEBOOK_APP_ID = import.meta.env.PUBLIC_FACEBOOK_APP_ID;
---

<div class="auth-container">
	<h2>Registro con Redes Sociales</h2>

	<!-- Botón de Facebook -->
	<button id="fb-login-btn" class="facebook-btn">
		<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white">
			<path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
		</svg>
		Continuar con Facebook
	</button>

	<!-- Área para mostrar los datos del usuario -->
	<div id="user-info" style="display: none;">
		<h3>Datos del Usuario:</h3>
		<div id="user-data"></div>
	</div>
</div>

<script define:vars={{ FACEBOOK_APP_ID }} is:inline>
	// Cargar el SDK de Facebook
	window.fbAsyncInit = function() {
		FB.init({
			appId: FACEBOOK_APP_ID,
			cookie: true,
			xfbml: true,
			version: 'v18.0'
		});

		// Registro de vistas de página para Facebook Analytics
		FB.AppEvents.logPageView();
	};

	// Cargar el SDK de forma asíncrona
	(function(d, s, id) {
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) return;
		js = d.createElement(s); js.id = id;
		js.src = "https://connect.facebook.net/es_ES/sdk.js";
		fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));

	// Función para obtener información del usuario
	function getUserInfo() {
		FB.api('/me', { fields: 'email,first_name,last_name,name' }, function(userData) {
			console.log('Datos del usuario:', userData);

			// Mostrar los datos en la página
			displayUserData({
				email: userData.email || 'No disponible',
				nombre: userData.first_name || 'No disponible',
				apellido: userData.last_name || 'No disponible',
				nombreCompleto: userData.name || 'No disponible'
			});

			// Aquí puedes enviar los datos a tu backend
			// sendToBackend(userData);
		});
	}

	// Función para manejar el login con el botón personalizado
	function handleFacebookLogin() {
		FB.login(function(response) {
			console.log('Respuesta de login:', response);

			if (response.authResponse) {
				// Usuario autenticado correctamente
				console.log('Usuario autenticado');
				getUserInfo();
			} else {
				// Usuario canceló el login
				console.log('El usuario canceló el login');
			}
		}, {
			scope: 'email,public_profile',
			return_scopes: true
		});
	}

	// Función para mostrar los datos del usuario
	function displayUserData(data) {
		const userInfo = document.getElementById('user-info');
		const userData = document.getElementById('user-data');

		userData.innerHTML = `
			<p><strong>Nombre:</strong> ${data.nombre}</p>
			<p><strong>Apellido:</strong> ${data.apellido}</p>
			<p><strong>Nombre Completo:</strong> ${data.nombreCompleto}</p>
			<p><strong>Correo:</strong> ${data.email}</p>
		`;

		userInfo.style.display = 'block';
	}

	// Agregar evento al botón
	document.addEventListener('DOMContentLoaded', function() {
		const fbLoginBtn = document.getElementById('fb-login-btn');
		if (fbLoginBtn) {
			fbLoginBtn.addEventListener('click', handleFacebookLogin);
		}
	});
</script>

<style>
	.auth-container {
		max-width: 400px;
		margin: 50px auto;
		padding: 30px;
		background: white;
		border-radius: 12px;
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
	}

	h2 {
		text-align: center;
		color: #333;
		margin-bottom: 30px;
		font-size: 24px;
	}

	.facebook-btn {
		width: 100%;
		display: flex;
		align-items: center;
		justify-content: center;
		gap: 10px;
		padding: 12px 24px;
		background-color: #1877f2;
		color: white;
		border: none;
		border-radius: 8px;
		font-size: 16px;
		font-weight: 600;
		cursor: pointer;
		transition: background-color 0.3s ease;
	}

	.facebook-btn:hover {
		background-color: #0d65d9;
	}

	.facebook-btn:active {
		transform: scale(0.98);
	}

	#user-info {
		margin-top: 30px;
		padding: 20px;
		background-color: #f8f9fa;
		border-radius: 8px;
		border-left: 4px solid #1877f2;
	}

	#user-info h3 {
		margin-top: 0;
		color: #333;
		font-size: 18px;
	}

	#user-data p {
		margin: 10px 0;
		color: #555;
		font-size: 14px;
	}

	#user-data strong {
		color: #333;
	}
</style>
